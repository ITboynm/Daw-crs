import{c as O}from"./dashboard-Ks6BhIBF.js";import{f as L}from"./formatters-CqQpRoa5.js";import{_ as T,r as k,o as $,v as y,c as d,e as c,i as o,w as r,f as a,N as U,H as N,I as A,L as q,h as i,y as h,m as E,D,B as F,p as v,z as C,J as I,K as P,t as l,x as t}from"./index-bpa48Sxk.js";import{u as K}from"./use-message-CHqbSZtC.js";import{N as G,a as m}from"./DescriptionsItem-CNP5OMk2.js";const Q={class:"logs-view"},R={class:"header-content"},W={class:"header-actions"},X={key:0,class:"action-filter"},Y=["onClick"],Z={class:"logs-container"},ee={key:0,class:"logs-timeline"},oe=["onClick"],te={class:"log-indicator"},se={key:0,class:"indicator-line"},ne={class:"log-card"},ae={class:"log-header"},ie={class:"log-action"},re={class:"action-text"},le={class:"log-time"},de={class:"log-body"},ce={class:"log-info"},ue={class:"info-item"},ve={class:"info-value"},pe={key:0,class:"info-item"},ke={class:"info-value"},he={key:1,class:"info-item"},me={class:"info-value"},fe={class:"info-item"},_e={class:"info-value"},we={key:1,class:"empty-state"},ge={key:0,class:"detail-content"},Me={class:"detail-section"},xe={key:0,class:"detail-section"},ye={class:"json-output"},Ce={__name:"LogsView",setup(Be){const S=K(),f=k([]),_=k(!1),w=k(""),p=k(""),u=k(null),g=k(!1);$(()=>{B()});async function B(){_.value=!0;try{const s=await O({size:100});f.value=s.data.logs||s.data||[]}catch(s){const e=s?.response?.data?.message||s?.message||"获取日志失败";S.error(e)}finally{_.value=!1}}const j=y(()=>{const s=new Set(f.value.map(e=>e.action).filter(Boolean));return Array.from(s)}),M=y(()=>{const s=w.value.trim().toLowerCase();return f.value.filter(e=>p.value&&e.action!==p.value?!1:s?[e.parent_name,e.user_name,e.details,e.ip].filter(Boolean).join(" ").toLowerCase().includes(s):!0).slice(0,100)});function z(s){p.value=p.value===s?"":s}function J(s){u.value=s,g.value=!0}function x(s){return{add_user:"创建子账户",recharge_user:"调整额度",update_user:"更新子账户",delete_user:"删除子账户",login:"登录",rotate_self:"轮换密钥",add_key:"新增 Provider",update_key:"更新 Provider",delete_key:"删除 Provider",update_config:"更新配置",create_news:"发布通知"}[s]||s||"--"}function H(s){return{add_user:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})]),recharge_user:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),update_user:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),delete_user:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})]),login:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})]),rotate_self:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})]),add_key:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),update_key:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})]),delete_key:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})]),update_config:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]),create_news:()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})])}[s]||(()=>t("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]))}const b=y(()=>{if(!u.value?.details)return"无详细数据";try{const s=JSON.parse(u.value.details);return JSON.stringify(s,null,2)}catch{return u.value.details}});return(s,e)=>(i(),d("section",Q,[c(a(U),{class:"header-card",bordered:!1},{default:r(()=>[o("div",R,[e[6]||(e[6]=o("div",{class:"header-info"},[o("div",{class:"icon-wrapper"},[o("svg",{class:"header-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),o("div",null,[o("h2",null,"操作日志"),o("p",null,"实时追踪敏感操作，支持关键词搜索与动作过滤")])],-1)),o("div",W,[c(a(E),{value:w.value,"onUpdate:value":e[0]||(e[0]=n=>w.value=n),placeholder:"搜索用户名、IP、详情",clearable:"",style:{width:"280px"}},{prefix:r(()=>[c(a(D),null,{default:r(()=>[...e[3]||(e[3]=[o("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])]),_:1})]),_:1},8,["value"]),c(a(F),{secondary:"",loading:_.value,onClick:B},{icon:r(()=>[c(a(D),null,{default:r(()=>[...e[4]||(e[4]=[o("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]),_:1})]),default:r(()=>[e[5]||(e[5]=v(" 刷新 ",-1))]),_:1},8,["loading"])])]),j.value.length?(i(),d("div",X,[o("button",{type:"button",class:C(["action-chip",{active:!p.value}]),onClick:e[1]||(e[1]=n=>z(""))},[...e[7]||(e[7]=[o("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),v(" 全部 ",-1)])],2),(i(!0),d(N,null,A(j.value,n=>(i(),d("button",{key:n,type:"button",class:C(["action-chip",{active:n===p.value}]),onClick:V=>z(n)},[(i(),I(P(H(n)),{class:"chip-icon"})),v(" "+l(x(n)),1)],10,Y))),128))])):h("",!0)]),_:1}),o("div",Z,[M.value.length?(i(),d("div",ee,[(i(!0),d(N,null,A(M.value,(n,V)=>(i(),d("div",{key:n.id,class:C(["log-item",{selected:u.value?.id===n.id}]),onClick:je=>J(n)},[o("div",te,[e[8]||(e[8]=o("div",{class:"indicator-dot"},null,-1)),V<M.value.length-1?(i(),d("div",se)):h("",!0)]),o("div",ne,[o("div",ae,[o("div",ie,[(i(),I(P(H(n.action)),{class:"action-icon"})),o("span",re,l(x(n.action)),1)]),o("div",le,[e[9]||(e[9]=o("svg",{class:"time-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),v(" "+l(a(L)(n.created_at,"MM-DD HH:mm:ss")),1)])]),o("div",de,[o("div",ce,[o("div",ue,[e[10]||(e[10]=o("svg",{class:"info-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e[11]||(e[11]=o("span",{class:"info-label"},"发起人",-1)),o("span",ve,l(n.parent_name||"--"),1)]),n.user_name?(i(),d("div",pe,[e[12]||(e[12]=o("svg",{class:"info-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1)),e[13]||(e[13]=o("span",{class:"info-label"},"子账户",-1)),o("span",ke,l(n.user_name),1)])):h("",!0),n.target_id?(i(),d("div",he,[e[14]||(e[14]=o("svg",{class:"info-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})],-1)),e[15]||(e[15]=o("span",{class:"info-label"},"目标",-1)),o("span",me,l(n.target_id),1)])):h("",!0),o("div",fe,[e[16]||(e[16]=o("svg",{class:"info-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})],-1)),e[17]||(e[17]=o("span",{class:"info-label"},"IP",-1)),o("span",_e,l(n.ip||"--"),1)])])])])],10,oe))),128))])):(i(),d("div",we,[...e[18]||(e[18]=[o("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),o("p",null,"没有匹配的日志记录",-1)])]))]),c(a(q),{show:g.value,"onUpdate:show":e[2]||(e[2]=n=>g.value=n),preset:"card",title:"日志详情",size:"large",style:{"max-width":"800px"}},{default:r(()=>[u.value?(i(),d("div",ge,[o("div",Me,[e[19]||(e[19]=o("h4",{class:"section-title"},"基本信息",-1)),c(a(G),null,{default:r(()=>[c(a(m),{label:"操作动作"},{default:r(()=>[v(l(x(u.value.action)),1)]),_:1}),c(a(m),{label:"发起人"},{default:r(()=>[v(l(u.value.parent_name||"--"),1)]),_:1}),c(a(m),{label:"子账户"},{default:r(()=>[v(l(u.value.user_name||"--"),1)]),_:1}),c(a(m),{label:"目标ID"},{default:r(()=>[v(l(u.value.target_id||"--"),1)]),_:1}),c(a(m),{label:"IP地址"},{default:r(()=>[v(l(u.value.ip||"--"),1)]),_:1}),c(a(m),{label:"操作时间"},{default:r(()=>[v(l(a(L)(u.value.created_at)),1)]),_:1})]),_:1})]),b.value!=="无详细数据"?(i(),d("div",xe,[e[20]||(e[20]=o("h4",{class:"section-title"},"操作详情",-1)),o("div",ye,[o("pre",null,l(b.value),1)])])):h("",!0)])):h("",!0)]),_:1},8,["show"])]))}},Ne=T(Ce,[["__scopeId","data-v-b5aaff7a"]]);export{Ne as default};
