import{_ as G,u as Q,v as D,r as f,c as u,e as i,w as o,f as n,N as S,L as W,h as c,i as e,y as _,H as I,I as q,t as a,p as d,m as Z,B as g,U as H,J as ee,b0 as se,z as le}from"./index-bpa48Sxk.js";import{b as te}from"./dashboard-Ks6BhIBF.js";import{f as B,m as ae,a as k,b as w}from"./formatters-CqQpRoa5.js";import{u as oe}from"./use-message-CHqbSZtC.js";import{N as A,a as v}from"./DescriptionsItem-CNP5OMk2.js";const ne={class:"api-key-view"},ie={class:"card-header"},re={key:0,class:"history-section"},de={class:"history-chips"},ce=["onClick"],ue={class:"query-body"},ve={class:"query-actions"},he={class:"action-buttons"},pe={class:"result-header"},ye={class:"result-header-left"},me={key:0,class:"result-table"},fe={class:"col-key key-cell"},_e=["onClick"],ke={key:0,class:"error-text"},be={class:"col-account account-cell"},ge={class:"account-line"},we={class:"account-line"},Ce={class:"account-line"},xe={class:"col-credits credits-cell"},Be={key:0,class:"credit-summary"},Me={class:"credit-line"},Ke={key:0,class:"credit-more"},Ie={key:1,class:"no-credits"},qe={class:"col-used-balance balance-cell"},Ae={class:"balance-line"},ze={class:"balance-line balance-highlight"},Re={class:"col-usage usage-cell"},Ue={class:"usage-line"},Ne={class:"col-requests requests-cell"},Pe={class:"requests-line"},De={class:"col-limits limits-cell"},Se={class:"col-actions actions-cell"},He={key:1,class:"empty-state"},Te={key:0,class:"detail-modal-content"},je={class:"detail-section"},Ye={class:"detail-key-info"},Ve={class:"detail-key"},$e={class:"detail-section"},Ee={key:0,class:"detail-section"},Le={class:"detail-section-title"},Je={class:"credit-detail-list"},Oe={class:"credit-detail-row"},Xe={class:"credit-detail-value"},Fe={class:"credit-detail-row"},Ge={class:"credit-detail-value balance"},Qe={class:"credit-detail-row"},We={class:"credit-detail-value"},Ze={class:"detail-section"},es={style:{color:"#10b981","font-weight":"600"}},ss={class:"detail-section"},ls={__name:"ApiKeyInsightsView",setup(ts){const m=oe(),T=Q(),z=D(()=>{const t=T.apiKey;return t?`dawapi:key-history:${t.substring(0,16)}`:"dawapi:key-history"}),b=f(""),p=f(!1),y=f([]),C=f(Y()),M=f(!1),r=f(null),j=D(()=>{if(!y.value.length)return"等待查询";const t=y.value.filter(l=>!l.error).length,s=y.value.length-t;return`成功 ${t} · 失败 ${s}`});function Y(){try{const t=localStorage.getItem(z.value);if(t)return JSON.parse(t)}catch(t){console.warn("history load failed",t)}return[]}function R(t){C.value=t;try{localStorage.setItem(z.value,JSON.stringify(t.slice(0,20)))}catch(s){console.warn("history persist failed",s)}}function V(t){b.value=t}function $(){R([])}function x(t){return ae(t,5)}async function E(){if(!navigator.clipboard){m.warning("浏览器不支持剪贴板 API，请手动粘贴");return}try{const t=await navigator.clipboard.readText();b.value=t.trim()}catch{m.error("无法读取剪贴板内容")}}function L(){const t=b.value.match(/sk-[^\s]+/gi)||[],s=Array.from(new Set(t.map(l=>l.trim())));if(!s.length)throw new Error("请输入有效的 API Key");return s.slice(0,50)}async function J(){let t;try{t=L()}catch(s){m.error(s.message);return}R([...t,...C.value.filter(s=>!t.includes(s))].slice(0,20)),p.value=!0;try{const s=await Promise.allSettled(t.map(l=>U(l)));y.value=s.map((l,h)=>l.status==="fulfilled"?l.value:{key:t[h],maskedKey:x(t[h]),error:l.reason?.message||"查询失败"})}finally{p.value=!1}}async function O(){if(!y.value.length)return;const t=y.value.map(s=>s.key);p.value=!0;try{const s=await Promise.allSettled(t.map(l=>U(l)));y.value=s.map((l,h)=>l.status==="fulfilled"?l.value:{key:t[h],maskedKey:x(t[h]),error:l.reason?.message||"查询失败"}),m.success("数据已刷新")}catch{m.error("刷新失败")}finally{p.value=!1}}async function U(t){try{const l=(await te(t)).data;return X(t,l)}catch(s){throw new Error(s?.response?.data?.message||"请求失败")}}function X(t,s){const l=(s.credit_balance||[]).map(K=>({amount:k(K.amount),balance:k(K.balance),expires:B(K.expires_at,"YYYY-MM-DD")})),h=s.daily_usage||{},P=s.monthly_usage||{};return{key:t,maskedKey:x(t),name:s.name||"--",email:s.email||"--",level:s.level||"--",child:s.child||"--",balance:k(s.balance||0),creditUsed:k(s.credit_used||0),dailyUsage:k(h.CreditUsed||0),dailyRequests:w(h.Requests||0),monthlyUsage:k(P.CreditUsed||0),monthlyRequests:w(P.Requests||0),createdAt:B(s.create_at),rpm:w(s.rpm||0),tpm:w(s.tpm||0),tpd:w(s.tpd||0),creditBalance:l}}async function N(t){try{await navigator.clipboard.writeText(t),m.success("已复制到剪贴板")}catch{m.error("复制失败")}}function F(t){r.value=t,M.value=!0}return(t,s)=>(c(),u("section",ne,[i(n(S),{class:"query-card",bordered:!1},{default:o(()=>[e("div",ie,[s[5]||(s[5]=e("div",{class:"header-main"},[e("div",{class:"icon-wrapper"},[e("svg",{class:"header-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})])]),e("div",null,[e("h2",null,"API Key 速查"),e("p",null,"一次性粘贴多个密钥，即刻返回账户余额、额度与创建时间")])],-1)),C.value.length?(c(),u("div",re,[s[4]||(s[4]=e("div",{class:"history-label"},[e("svg",{class:"label-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",null,"历史记录")],-1)),e("div",de,[(c(!0),u(I,null,q(C.value.slice(0,5),l=>(c(),u("button",{key:l,type:"button",class:"history-chip",onClick:h=>V(l)},a(x(l)),9,ce))),128)),e("button",{type:"button",class:"history-clear",onClick:$},[...s[3]||(s[3]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),d(" 清空 ",-1)])])])])):_("",!0)]),e("div",ue,[i(n(Z),{value:b.value,"onUpdate:value":s[0]||(s[0]=l=>b.value=l),type:"textarea",placeholder:`每行一个 sk-Xvs... 密钥

支持批量粘贴，自动识别提取`,autosize:{minRows:5,maxRows:12}},null,8,["value"]),e("div",ve,[s[9]||(s[9]=e("div",{class:"hint-group"},[e("svg",{class:"hint-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"hint"},"支持粘贴原有查询历史，最多检测 50 个密钥")],-1)),e("div",he,[i(n(g),{quaternary:"",size:"medium",onClick:E},{icon:o(()=>[...s[6]||(s[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)])]),default:o(()=>[s[7]||(s[7]=d(" 从剪贴板粘贴 ",-1))]),_:1}),i(n(g),{type:"primary",size:"medium",loading:p.value,onClick:J},H({default:o(()=>[d(" "+a(p.value?"查询中...":"开始查询"),1)]),_:2},[p.value?void 0:{name:"icon",fn:o(()=>[s[8]||(s[8]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),key:"0"}]),1032,["loading"])])])])]),_:1}),i(n(S),{class:"result-card",bordered:!1},{default:o(()=>[e("header",pe,[e("div",ye,[s[10]||(s[10]=e("h3",null,"查询结果",-1)),e("p",null,a(j.value),1)]),y.value.length?(c(),ee(n(se),{key:0,placement:"top",trigger:"hover"},{trigger:o(()=>[i(n(g),{type:"primary",size:"medium",loading:p.value,onClick:O},H({default:o(()=>[d(" "+a(p.value?"刷新中...":"刷新数据"),1)]),_:2},[p.value?void 0:{name:"icon",fn:o(()=>[s[11]||(s[11]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1))]),key:"0"}]),1032,["loading"])]),default:o(()=>[s[12]||(s[12]=e("div",{style:{"max-width":"240px","text-align":"center"}}," ⚠️ 切勿频繁触发查询，否则会触发系统防御性扣额度 ",-1))]),_:1})):_("",!0)]),y.value.length?(c(),u("div",me,[s[17]||(s[17]=e("div",{class:"table-head"},[e("div",{class:"col-key"},[e("div",{class:"head-label"},"XAI API Key")]),e("div",{class:"col-account"},[e("div",{class:"head-label"},"账户信息"),e("div",{class:"head-sub"},"ID / 等级 / 子账户数 / 用户名 / 邮箱 / 创建时间")]),e("div",{class:"col-credits"},[e("div",{class:"head-label"},"充值卡"),e("div",{class:"head-sub"},"卡额 / 余额 / 到期时间")]),e("div",{class:"col-used-balance"},[e("div",{class:"head-label"},"已用 / 余额"),e("div",{class:"head-sub"},"总消费 / 总余额")]),e("div",{class:"col-usage"},[e("div",{class:"head-label"},"使用量"),e("div",{class:"head-sub"},"今日 / 本月 (占比)")]),e("div",{class:"col-requests"},[e("div",{class:"head-label"},"请求数"),e("div",{class:"head-sub"},"今日 / 本月 (占比)")]),e("div",{class:"col-limits"},[e("div",{class:"head-label"},"速率限制"),e("div",{class:"head-sub"},"RPM / TPD")]),e("div",{class:"col-actions"},[e("div",{class:"head-label"},"操作")])],-1)),(c(!0),u(I,null,q(y.value,l=>(c(),u("div",{key:l.key,class:le(["table-row",{error:l.error}])},[e("div",fe,[e("strong",null,a(l.maskedKey),1),e("button",{type:"button",class:"copy-button",onClick:h=>N(l.key)},"复制",8,_e),l.error?(c(),u("span",ke,a(l.error),1)):_("",!0)]),e("div",be,[e("div",ge,[e("strong",null,a(l.level),1),d(" / "+a(l.child)+" / "+a(l.name),1)]),e("div",we,a(l.email),1),e("div",Ce,a(n(B)(l.createdAt,"YYYY/MM/DD HH:mm:ss")),1)]),e("div",xe,[l.creditBalance&&l.creditBalance.length?(c(),u("div",Be,[e("div",Me,[e("span",null,a(l.creditBalance[0].amount),1),e("span",null,a(l.creditBalance[0].balance),1),e("span",null,a(l.creditBalance[0].expires),1)]),l.creditBalance.length>1?(c(),u("div",Ke," +"+a(l.creditBalance.length-1)+" 更多 ",1)):_("",!0)])):(c(),u("div",Ie,"--"))]),e("div",qe,[e("div",Ae,a(l.creditUsed),1),e("div",ze,a(l.balance),1)]),e("div",Re,[e("div",Ue,a(l.dailyUsage)+" / "+a(l.monthlyUsage),1),s[13]||(s[13]=e("div",{class:"usage-meta"},"(0.00%)",-1))]),e("div",Ne,[e("div",Pe,a(l.dailyRequests)+" / "+a(l.monthlyRequests),1),s[14]||(s[14]=e("div",{class:"requests-meta"},"(0.00%)",-1))]),e("div",De,[e("div",null,"RPM "+a(l.rpm),1),e("div",null,"TPD "+a(l.tpd),1)]),e("div",Se,[i(n(g),{size:"tiny",quaternary:"",onClick:h=>F(l)},{icon:o(()=>[...s[15]||(s[15]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])]),default:o(()=>[s[16]||(s[16]=d(" 查看 ",-1))]),_:1},8,["onClick"])])],2))),128))])):(c(),u("div",He,[...s[18]||(s[18]=[e("p",null,"暂未查询或没有有效密钥。",-1)])]))]),_:1}),i(n(W),{show:M.value,"onUpdate:show":s[2]||(s[2]=l=>M.value=l),preset:"card",title:"API Key 详细信息",size:"large",style:{"max-width":"900px"}},{default:o(()=>[r.value?(c(),u("div",Te,[e("div",je,[s[20]||(s[20]=e("h4",{class:"detail-section-title"},"API Key",-1)),e("div",Ye,[e("span",Ve,a(r.value.maskedKey),1),i(n(g),{size:"tiny",onClick:s[1]||(s[1]=l=>N(r.value.key))},{default:o(()=>[...s[19]||(s[19]=[d("复制完整Key",-1)])]),_:1})])]),e("div",$e,[s[21]||(s[21]=e("h4",{class:"detail-section-title"},"账户信息",-1)),i(n(A),{column:2,bordered:"",size:"small"},{default:o(()=>[i(n(v),{label:"用户名"},{default:o(()=>[d(a(r.value.name),1)]),_:1}),i(n(v),{label:"邮箱"},{default:o(()=>[d(a(r.value.email),1)]),_:1}),i(n(v),{label:"等级"},{default:o(()=>[d(a(r.value.level),1)]),_:1}),i(n(v),{label:"子账户数"},{default:o(()=>[d(a(r.value.child),1)]),_:1}),i(n(v),{label:"创建时间",span:2},{default:o(()=>[d(a(n(B)(r.value.createdAt)),1)]),_:1})]),_:1})]),r.value.creditBalance&&r.value.creditBalance.length?(c(),u("div",Ee,[e("h4",Le,"充值卡明细 ("+a(r.value.creditBalance.length)+")",1),e("div",Je,[(c(!0),u(I,null,q(r.value.creditBalance,(l,h)=>(c(),u("div",{key:h,class:"credit-detail-item"},[e("div",Oe,[s[22]||(s[22]=e("span",{class:"credit-detail-label"},"卡额：",-1)),e("span",Xe,a(l.amount),1)]),e("div",Fe,[s[23]||(s[23]=e("span",{class:"credit-detail-label"},"余额：",-1)),e("span",Ge,a(l.balance),1)]),e("div",Qe,[s[24]||(s[24]=e("span",{class:"credit-detail-label"},"到期：",-1)),e("span",We,a(l.expires),1)])]))),128))])])):_("",!0),e("div",Ze,[s[25]||(s[25]=e("h4",{class:"detail-section-title"},"使用统计",-1)),i(n(A),{column:2,bordered:"",size:"small"},{default:o(()=>[i(n(v),{label:"总消费"},{default:o(()=>[d(a(r.value.creditUsed),1)]),_:1}),i(n(v),{label:"总余额"},{default:o(()=>[e("span",es,a(r.value.balance),1)]),_:1}),i(n(v),{label:"今日使用量"},{default:o(()=>[d(a(r.value.dailyUsage),1)]),_:1}),i(n(v),{label:"本月使用量"},{default:o(()=>[d(a(r.value.monthlyUsage),1)]),_:1}),i(n(v),{label:"今日请求数"},{default:o(()=>[d(a(r.value.dailyRequests),1)]),_:1}),i(n(v),{label:"本月请求数"},{default:o(()=>[d(a(r.value.monthlyRequests),1)]),_:1})]),_:1})]),e("div",ss,[s[26]||(s[26]=e("h4",{class:"detail-section-title"},"速率限制",-1)),i(n(A),{column:3,bordered:"",size:"small"},{default:o(()=>[i(n(v),{label:"RPM"},{default:o(()=>[d(a(r.value.rpm),1)]),_:1}),i(n(v),{label:"TPM"},{default:o(()=>[d(a(r.value.tpm),1)]),_:1}),i(n(v),{label:"TPD"},{default:o(()=>[d(a(r.value.tpd),1)]),_:1})]),_:1})])])):_("",!0)]),_:1},8,["show"])]))}},ds=G(ls,[["__scopeId","data-v-85a70b82"]]);export{ds as default};
