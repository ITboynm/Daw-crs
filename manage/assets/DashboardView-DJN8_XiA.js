import{s as z,c as i,d as Fe,h as n,i as t,_ as Ve,u as We,r as u,P as h,o as Ee,g as Je,b as Ge,Q as Qe,R as Xe,v as f,e as r,t as c,w as d,f as l,B as x,y as O,H as $,I as R,J as se,T as we,U as Ze,N as et,L as tt,p as m,z as ae,K as st,V as at,W as ge,X as lt,D as T,m as nt,Y as G,Z as rt,$ as ot}from"./index-bpa48Sxk.js";import{u as it}from"./useNotifications-BAmmmttN.js";import{g as ke,a as ut,b as ct}from"./dashboard-Ks6BhIBF.js";import{r as dt}from"./accounts-DmvIR8TI.js";import{a as D,b as _,f as Q,m as pt,d as _e}from"./formatters-CqQpRoa5.js";import{C as vt}from"./CopyOutline-Cp_FYSuT.js";import{W as ft,C as mt}from"./WarningOutline-BIDwubHm.js";import{R as yt}from"./RefreshOutline-DcgKp7UY.js";import{u as ht}from"./use-message-CHqbSZtC.js";const wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gt=z({name:"CalendarOutline",render:function(p,v){return n(),i("svg",wt,v[0]||(v[0]=[Fe('<rect fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" x="48" y="80" width="416" height="384" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" stroke-linecap="round" d="M128 48v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" stroke-linecap="round" d="M384 48v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path>',13)]))}}),kt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},_t=z({name:"CloseCircleOutline",render:function(p,v){return n(),i("svg",kt,v[0]||(v[0]=[t("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 320L192 192"},null,-1),t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M192 320l128-128"},null,-1)]))}}),bt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},xt=z({name:"FlashOutline",render:function(p,v){return n(),i("svg",bt,v[0]||(v[0]=[t("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Ct={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Mt=z({name:"PulseOutline",render:function(p,v){return n(),i("svg",Ct,v[0]||(v[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M48 320h64l64-256l64 384l64-224l32 96h64"},null,-1),t("circle",{cx:"432",cy:"320",r:"32",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Dt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},St=z({name:"WalletOutline",render:function(p,v){return n(),i("svg",Dt,v[0]||(v[0]=[t("rect",{x:"48",y:"144",width:"416",height:"288",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),t("path",{d:"M411.36 144v-30A50 50 0 0 0 352 64.9L88.64 109.85A50 50 0 0 0 48 159v49",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),t("path",{d:"M368 320a32 32 0 1 1 32-32a32 32 0 0 1-32 32z",fill:"currentColor"},null,-1)]))}}),Nt={class:"dashboard-view"},Yt={class:"dashboard-hero"},Ot={class:"hero-unified"},qt={class:"hero-header"},It={class:"hero-header-left"},Pt={class:"hero-greeting"},At={class:"hero-balance"},Kt={class:"hero-balance__value"},$t={class:"hero-content"},Rt={class:"hero-section api-key-section"},Tt={class:"section-header"},Lt={class:"section-actions"},zt={class:"key-value"},Bt={class:"hero-section usage-section"},Ut={class:"section-header"},jt={key:0,class:"usage-loading"},Ht={class:"usage-grid"},Ft={class:"label"},Vt={class:"value"},Wt={key:0,class:"empty"},Et={class:"hero-footer"},Jt={class:"summary-section"},Gt={class:"summary-controls"},Qt={class:"filter-tabs"},Xt=["onClick"],Zt={class:"filter-controls"},es={class:"refresh-button-wrapper"},ts={class:"summary-cards"},ss={class:"content"},as={class:"label"},ls={class:"value"},ns={class:"hint"},rs={class:"panel-header"},os={class:"sort-group"},is=["onClick"],us={key:0,class:"models-table"},cs=["title"],ds={class:"progress-bar"},ps={key:1,class:"empty-state"},vs={key:0,class:"rotate-step"},fs={class:"modal-actions"},ms={key:1,class:"rotate-step rotate-step--center"},ys={key:2,class:"rotate-step"},hs={class:"key-display-section"},ws={class:"key-display-value"},gs={class:"key-confirm-section"},ks={class:"key-confirm-label"},_s={key:0,class:"key-confirm-error"},bs={key:1,class:"key-confirm-success"},xs={class:"modal-actions"},L=7200*1e3,Cs="dawapi:news-dismissed-date",Ms={__name:"DashboardView",setup(q){const p=We(),v=Ge(),le=Je(),w=ht(),{fetchNews:be,stopPolling:xe,startPolling:B}=it(),X=u(!1),I=u(!1),U=u(!1),j=u(p.profile||null),H=u(null),Ce=u(null),Z=u([]),F=u(null),V=u(null),W=u(!1),ne=u(new Set);u(null);const P=u(!1),g=u("confirm"),b=u(""),A=u(""),E=u(!1);let k=null;const Me=[{label:"今日实时",value:"today"},{label:"指定日期",value:"date"},{label:"时间范围",value:"range"}],C=u("today"),K=u(h().valueOf()),M=u([h().subtract(6,"day").startOf("day").valueOf(),h().endOf("day").valueOf()]);Ee(async()=>{$e(),await S(),be(),k=window.setInterval(()=>{S()},L),le.query.action==="rotate-key"&&(ve(),v.replace({name:"dashboard"}))}),Qe(()=>le.query.action,s=>{s==="rotate-key"&&(ve(),v.replace({name:"dashboard"}))}),Xe(()=>{k&&(window.clearInterval(k),k=null)});async function S(){X.value=!0;try{const s=re(),[e,a]=await Promise.all([ke(s),ut()]);j.value=p.profile,H.value=e.data,Z.value=De(a.data),Se()&&(Z.value=[]),await ie(),V.value=new Date}catch(s){const e=s?.response?.data?.message||s?.message||"加载仪表盘数据失败";w.error(e)}finally{X.value=!1}}function re(){return C.value==="date"?{date:h(K.value).format("YYYY-MM-DD")}:C.value==="range"&&Array.isArray(M.value)?{start:h(M.value[0]).format("YYYY-MM-DD"),end:h(M.value[1]).format("YYYY-MM-DD")}:{}}async function oe(){I.value=!0;try{const s=await ke(re());j.value=p.profile,H.value=s.data,await ie(),V.value=new Date}catch(s){const e=s?.response?.data?.message||s?.message||"刷新失败";w.error(e)}finally{I.value=!1}}async function ie(){if(!p.apiKey){F.value=null;return}U.value=!0;try{const s=await ct(p.apiKey);F.value=s.data}catch{F.value=null}finally{U.value=!1}}function De(s={}){const e=[],a=(o=[],y)=>{o.forEach(Y=>{e.push({...Y,id:`${y}-${Y.created_at||Math.random()}`,type:y,typeLabel:y==="sys"?"系统":y==="user"?"账户":"族群",expiresText:_e(Y.expires_at)})})};return a(s.sys_news,"sys"),a(s.user_news,"user"),a(s.dna_news,"dna"),e.sort((o,y)=>new Date(y.created_at)-new Date(o.created_at))}function Se(){try{const s=localStorage.getItem(Cs);return s?s===new Date().toDateString():!1}catch{return!1}}const Ne=f(()=>p.displayName||"访客"),Ye=f(()=>D(j.value?.balance?.total??p.balance??0,{scientific:!0})),J={balance:St,requests:Mt,tokens:xt,image:gt},Oe=f(()=>{const s=H.value||{};return[{key:"balance",label:"总花费",value:D(s.total_credit_used||0,{scientific:!0}),hint:"USD",icon:J.balance},{key:"requests",label:"总请求",value:_(s.total_requests||0,{scientific:!0}),hint:"Requests",icon:J.requests},{key:"tokens",label:"总 Tokens",value:_(s.total_prompt+s.total_completion||0,{scientific:!0}),hint:"Prompt + Completion",icon:J.tokens},{key:"image",label:"图片处理",value:_(s.total_image_n||0,{scientific:!1}),hint:"Count",icon:J.image}]}),ue=f(()=>{const s=F.value;if(!s)return[];const e=[];s.balance!==void 0&&e.push({label:"余额",value:D(s.balance,{scientific:!0})}),s.credit_used!==void 0&&e.push({label:"已使用",value:D(s.credit_used,{scientific:!0})});const a=s.rpm??s.requests_per_minute;a!==void 0&&e.push({label:"RPM",value:_(a,{scientific:!0})});const o=s.tpm??s.tokens_per_minute;return o!==void 0&&e.push({label:"TPM",value:_(o,{scientific:!0})}),s.create_at&&e.push({label:"创建时间",value:Q(s.create_at,"YYYY-MM-DD HH:mm")}),e}),qe=f(()=>p.apiKey?W.value?p.apiKey:pt(p.apiKey,4):"--"),N=f(()=>(Ce.value?.daily_costs||[]).map(e=>({date:Q(e.timestamp*1e3,"MM-DD"),cost:Number(e.cost||e.total_cost||0),requests:Number(e.requests||e.total_requests||0)})).sort((e,a)=>e.date>a.date?1:-1)),Ie=f(()=>N.value.length>0&&N.value.some(s=>s.cost>0));f(()=>Ie.value?{color:["#5a56f6","#f472b6"],tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.92)",borderWidth:0,textStyle:{color:"#f8fafc"},formatter:s=>{const[e,a]=s;return[`<strong>${e.axisValue}</strong>`,`花费：${D(e.data,{scientific:!0})}`,a?`请求：${_(a.data)}`:""].filter(Boolean).join("<br/>")}},legend:{data:["花费","请求数"],top:16,icon:"roundRect"},grid:{left:"3%",right:"4%",bottom:"6%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:N.value.map(s=>s.date),axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.4)"}}},yAxis:[{type:"value",name:"花费 (USD)",axisLabel:{formatter:s=>`$${_(s,{scientific:!0})}`},axisLine:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}}},{type:"value",name:"请求数",position:"right",axisLabel:{formatter:s=>_(s,{maximumFractionDigits:0,scientific:!1})},axisLine:{show:!1},splitLine:{show:!1}}],series:[{name:"花费",type:"line",smooth:!0,symbol:"circle",data:N.value.map(s=>s.cost),areaStyle:{color:"rgba(90, 86, 246, 0.18)"}},{name:"请求数",type:"bar",yAxisIndex:1,barWidth:14,data:N.value.map(s=>s.requests),itemStyle:{borderRadius:[8,8,0,0]}}]}:{}),f(()=>{switch(C.value){case"date":return`指定日期 · ${h(K.value).format("YYYY-MM-DD")} 用量趋势`;case"range":return`时间范围 · ${h(M.value[0]).format("MM-DD")} 至 ${h(M.value[1]).format("MM-DD")} 用量趋势`;default:return"近 7 天用量趋势"}}),f(()=>{switch(C.value){case"date":return"指定日期账单统计，可用于账务对账。";case"range":return"按时间范围统计，建议不超过 30 天。";default:return"实时账单数据，帮助判断成本波动。"}}),f(()=>{const s=N.value.reduce((e,a)=>(e.cost+=a.cost,e.requests+=a.requests,e),{cost:0,requests:0});return{totalCost:D(s.cost||0,{scientific:!0}),totalRequests:_(s.requests||0)}}),f(()=>(j.value?.balance?.credits||[]).map(e=>{const a=Q(e.expires_at,"YYYY-MM-DD"),o=_e(e.expires_at),y=o!=="已过期"&&(o.includes("天")||o.includes("小时"));return{amount:D(e.amount||e.balance||0,{scientific:!0}),expires:a,remainingText:o,isWarning:y,expires_at:e.expires_at}}));const Pe=[{label:"按花费",value:"cost"},{label:"按请求",value:"requests"},{label:"按 Prompt",value:"prompt"},{label:"按 Completion",value:"completion"}],ee=u("cost"),ce=f(()=>{const s=H.value?.usage_summary||{},e=Object.entries(s).map(([a,o])=>{const y=o.model_stats||{},Y=y.CreditUsed||0,fe=y.Requests||0,me=y.Prompt||0,ye=y.Completion||0,he=o.usage_analysis?.cost_percentage||0;return{name:a,displayName:a.length>32?`${a.slice(0,29)}…`:a,cost:D(Y,{scientific:!0}),requests:_(fe),prompt:_(me),completion:_(ye),percentage:`${he.toFixed(1)}%`,percentageWidth:`${Math.min(100,he)}%`,raw:{cost:Y,requests:fe,prompt:me,completion:ye}}});switch(ee.value){case"requests":e.sort((a,o)=>o.raw.requests-a.raw.requests);break;case"prompt":e.sort((a,o)=>o.raw.prompt-a.raw.prompt);break;case"completion":e.sort((a,o)=>o.raw.completion-a.raw.completion);break;default:e.sort((a,o)=>o.raw.cost-a.raw.cost);break}return e}),de=f(()=>Z.value.filter(s=>!ne.value.has(s.id)));f(()=>de.value.length),f(()=>de.value.slice(0,3));const Ae=f(()=>g.value==="processing"?"密钥轮换中":g.value==="result"?"新密钥已生成":"变更 API 密钥"),te=f(()=>A.value.trim()===b.value.trim()),Ke=f(()=>V.value?Q(V.value,"YYYY-MM-DD HH:mm"):"尚未刷新");function $e(){try{const s=localStorage.getItem("dawapi:news-dismissed");s&&(ne.value=new Set(JSON.parse(s)))}catch(s){console.warn("Failed to load dismissed news cache",s)}}function Re(s){C.value=s,s==="today"&&(K.value=h().valueOf(),M.value=[h().subtract(6,"day").startOf("day").valueOf(),h().endOf("day").valueOf()],oe())}function pe(s){return s>Date.now()}function Te(){W.value=!W.value}async function Le(){if(!p.apiKey||!navigator.clipboard){w.warning("无法复制密钥");return}try{await navigator.clipboard.writeText(p.apiKey),w.success("密钥已复制")}catch{w.error("复制失败")}}function ve(){P.value=!0,g.value="confirm",b.value="",A.value="",E.value=!1}async function ze(){g.value="processing",E.value=!1,k&&(window.clearInterval(k),k=null),xe(),ot();try{const e=`${h().format("YYYY-MM-DD")}-ROTATE-SELF`,a=await dt({confirm:e});if(b.value=a?.data?.SecretKey||a?.data?.secret_key||a?.data?.NewSecretKey||a?.data?.data?.SecretKey||"",!b.value){w.warning("接口未返回新密钥，请确认后端配置"),g.value="confirm",k=window.setInterval(()=>{S()},L),B(6e4),G();return}p.apiKey=b.value,localStorage.setItem("dawapi:api-key",b.value),rt(b.value),G(),k=window.setInterval(()=>{S()},L),B(6e4),g.value="result"}catch(s){const e=s?.response?.data?.message||s?.message||"轮换密钥失败";w.error(e),g.value="confirm",G(),k=window.setInterval(()=>{S()},L),B(6e4)}}async function Be(){if(!b.value){w.warning("暂无可复制的密钥");return}if(!navigator.clipboard){w.warning("浏览器不支持剪贴板，请使用保存功能");return}try{await navigator.clipboard.writeText(b.value),w.success("已复制到剪贴板"),E.value=!0}catch{w.error("复制失败，请手动复制或保存文件")}}function Ue(){g.value!=="processing"&&(P.value=!1,G(),k||(k=window.setInterval(()=>{S()},L)),B(6e4))}function je(){P.value=!1,w.success("密钥已轮换，请使用新密钥重新登录"),p.logout(),v.replace({name:"login",query:{reason:"rotate"}})}function He(s){v.push({name:s}).catch(()=>{})}return(s,e)=>(n(),i("section",Nt,[t("div",Yt,[t("div",Ot,[t("div",qt,[t("div",It,[t("p",Pt,"欢迎回来，"+c(Ne.value),1),e[5]||(e[5]=t("h1",{class:"hero-title"},"DawAPI 分发控制中心",-1))]),t("div",At,[e[6]||(e[6]=t("span",{class:"hero-balance__label"},"可用余额",-1)),t("span",Kt,c(Ye.value),1)])]),t("div",$t,[t("div",Rt,[t("div",Tt,[e[9]||(e[9]=t("span",{class:"section-title"},"当前 API Key",-1)),t("div",Lt,[r(l(x),{text:"",size:"small",onClick:Te},{default:d(()=>[m(c(W.value?"隐藏":"显示"),1)]),_:1}),r(l(x),{text:"",size:"small",onClick:Le,disabled:!l(p).apiKey},{default:d(()=>[...e[7]||(e[7]=[m("复制",-1)])]),_:1},8,["disabled"]),r(l(x),{text:"",size:"small",onClick:e[0]||(e[0]=a=>He("api-reference"))},{default:d(()=>[...e[8]||(e[8]=[m("调用示例",-1)])]),_:1})])]),t("div",zt,c(qe.value),1)]),t("div",Bt,[t("div",Ut,[e[10]||(e[10]=t("span",{class:"section-title"},"密钥速览",-1)),U.value?(n(),i("span",jt,"加载中...")):O("",!0)]),t("ul",Ht,[(n(!0),i($,null,R(ue.value,a=>(n(),i("li",{key:a.label},[t("span",Ft,c(a.label),1),t("span",Vt,c(a.value),1)]))),128)),!U.value&&!ue.value.length?(n(),i("li",Wt," 暂无密钥用量数据 ")):O("",!0)])])]),t("div",Et,[t("span",null,"最近更新 · "+c(Ke.value),1),r(l(x),{quaternary:"",circle:"",loading:X.value,onClick:S,class:"refresh-button"},{icon:d(()=>[...e[11]||(e[11]=[t("svg",{class:"refresh-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]),_:1},8,["loading"])])])]),t("section",Jt,[t("div",Gt,[t("div",Qt,[(n(),i($,null,R(Me,a=>t("button",{key:a.value,type:"button",class:ae(["filter-tab",{active:C.value===a.value}]),onClick:o=>Re(a.value)},c(a.label),11,Xt)),64))]),t("div",Zt,[C.value==="date"?(n(),se(l(we),{key:0,value:K.value,"onUpdate:value":e[1]||(e[1]=a=>K.value=a),type:"date",size:"small","is-date-disabled":pe},null,8,["value"])):O("",!0),C.value==="range"?(n(),se(l(we),{key:1,value:M.value,"onUpdate:value":e[2]||(e[2]=a=>M.value=a),type:"daterange",size:"small","is-date-disabled":pe},null,8,["value"])):O("",!0),t("div",es,[r(l(x),{type:"primary",size:"medium",loading:I.value,onClick:oe,class:"refresh-data-button"},Ze({default:d(()=>[m(" "+c(I.value?"加载中...":"刷新数据"),1)]),_:2},[I.value?void 0:{name:"icon",fn:d(()=>[e[12]||(e[12]=t("svg",{class:"refresh-data-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1))]),key:"0"}]),1032,["loading"]),e[13]||(e[13]=t("div",{class:"refresh-warning"},[t("svg",{class:"warning-icon-small",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),t("span",null,"切勿频繁触发查询，否则会触发系统防御性扣额度")],-1))])])]),t("div",ts,[(n(!0),i($,null,R(Oe.value,a=>(n(),i("article",{key:a.key,class:"summary-card"},[t("div",{class:ae(["icon",`icon-${a.key}`])},[(n(),se(st(a.icon),{size:"20"}))],2),t("div",ss,[t("span",as,c(a.label),1),t("span",ls,c(a.value),1),t("span",ns,c(a.hint),1)])]))),128))]),r(l(et),{class:"panel-card large-panel",bordered:!1},{default:d(()=>[t("header",rs,[e[14]||(e[14]=t("div",null,[t("h3",null,"模型消耗详情"),t("p",null,"按照成本排序，识别高消耗模型。")],-1)),t("div",os,[(n(),i($,null,R(Pe,a=>t("button",{key:a.value,class:ae(["sort-chip",{active:ee.value===a.value}]),type:"button",onClick:o=>ee.value=a.value},c(a.label),11,is)),64))])]),ce.value.length?(n(),i("div",us,[e[15]||(e[15]=t("div",{class:"table-head"},[t("span",null,"模型"),t("span",null,"请求数"),t("span",null,"Prompt"),t("span",null,"Completion"),t("span",null,"花费"),t("span",null,"占比")],-1)),(n(!0),i($,null,R(ce.value,a=>(n(),i("div",{key:a.name,class:"table-row"},[t("span",{class:"model-name",title:a.name},c(a.displayName),9,cs),t("span",null,c(a.requests),1),t("span",null,c(a.prompt),1),t("span",null,c(a.completion),1),t("span",null,c(a.cost),1),t("span",null,[t("div",ds,[t("div",{class:"progress-bar__inner",style:at({width:a.percentageWidth})},null,4)]),m(" "+c(a.percentage),1)])]))),128))])):(n(),i("div",ps," 暂无模型数据 "))]),_:1})]),r(l(tt),{show:P.value,"onUpdate:show":e[4]||(e[4]=a=>P.value=a),preset:"card",title:Ae.value,size:"medium",closable:g.value!=="processing","mask-closable":!1,style:{"max-width":"560px"}},{default:d(()=>[g.value==="confirm"?(n(),i("div",vs,[r(l(ge),{type:"warning",title:"风险操作警告",bordered:!1},{default:d(()=>[...e[16]||(e[16]=[t("div",{style:{"line-height":"1.6"}},[t("p",{style:{margin:"0 0 12px 0"}},"此操作将立即作废当前密钥并生成新密钥，具有以下风险："),t("ul",{style:{margin:"0","padding-left":"20px"}},[t("li",null,[m("当前密钥将"),t("strong",null,"立即失效"),m("，无法撤销")]),t("li",null,[m("所有使用旧密钥的服务将"),t("strong",null,"无法访问")]),t("li",null,[m("您需要使用新密钥"),t("strong",null,"重新登录"),m("系统")])])],-1)])]),_:1}),t("div",fs,[r(l(x),{onClick:Ue},{default:d(()=>[...e[17]||(e[17]=[m("取消",-1)])]),_:1}),r(l(x),{type:"error",onClick:ze},{default:d(()=>[...e[18]||(e[18]=[m(" 确认变更密钥 ",-1)])]),_:1})])])):g.value==="processing"?(n(),i("div",ms,[r(l(lt),{size:"large"}),e[19]||(e[19]=t("span",{class:"rotate-text"},"正在生成新密钥，请稍候...",-1))])):g.value==="result"?(n(),i("div",ys,[r(l(ge),{type:"success",title:"新密钥已生成",bordered:!1},{default:d(()=>[...e[20]||(e[20]=[m(" 请妥善保管新密钥，当前密钥已失效 ",-1)])]),_:1}),t("div",hs,[e[21]||(e[21]=t("div",{class:"key-display-label"},"新 API 密钥",-1)),t("div",ws,c(b.value),1),r(l(x),{type:"primary",block:"",onClick:Be},{icon:d(()=>[r(l(T),null,{default:d(()=>[r(l(vt))]),_:1})]),default:d(()=>[m(" "+c(E.value?"已复制":"快捷复制"),1)]),_:1})]),t("div",gs,[t("div",ks,[r(l(T),{size:"18",color:"#f59e0b"},{default:d(()=>[r(l(ft))]),_:1}),e[22]||(e[22]=t("span",null,"请输入上方密钥以确认",-1))]),r(l(nt),{value:A.value,"onUpdate:value":e[3]||(e[3]=a=>A.value=a),type:"text",placeholder:"粘贴或手动输入新密钥","input-props":{autocomplete:"off"}},null,8,["value"]),A.value&&!te.value?(n(),i("div",_s,[r(l(T),{size:"16"},{default:d(()=>[r(l(_t))]),_:1}),e[23]||(e[23]=t("span",null,"输入的密钥不匹配，请检查",-1))])):te.value?(n(),i("div",bs,[r(l(T),{size:"16"},{default:d(()=>[r(l(mt))]),_:1}),e[24]||(e[24]=t("span",null,"密钥确认成功",-1))])):O("",!0)]),t("div",xs,[r(l(x),{type:"primary",block:"",size:"large",disabled:!te.value,onClick:je},{icon:d(()=>[r(l(T),null,{default:d(()=>[r(l(yt))]),_:1})]),default:d(()=>[e[25]||(e[25]=m(" 重启系统并使用新密钥登录 ",-1))]),_:1},8,["disabled"])])])):O("",!0)]),_:1},8,["show","title","closable"])]))}},Ks=Ve(Ms,[["__scopeId","data-v-f7d51ee7"]]);export{Ks as default};
