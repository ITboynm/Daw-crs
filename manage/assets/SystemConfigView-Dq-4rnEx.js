import{g as F,d as q,u as Q}from"./admin-BtnSuRvZ.js";import{ab as $,az as B,ay as c,ax as L,aW as U,s as Y,x as Z,af as ee,b4 as le,aJ as te,au as ae,bK as oe,_ as se,r as I,o as re,Q as ne,c as M,e as a,w as r,f as o,N as ie,h as b,i as n,B as m,p as g,j as ue,l as v,m as d,aB as de,H as T,I as V,bJ as G}from"./index-bpa48Sxk.js";import{u as pe}from"./use-message-CHqbSZtC.js";const i="0!important",k="-1px!important";function S(f){return c(`${f}-type`,[L("& +",[$("button",{},[c(`${f}-type`,[U("border",{borderLeftWidth:i}),U("state-border",{left:k})])])])])}function P(f){return c(`${f}-type`,[L("& +",[$("button",[c(`${f}-type`,[U("border",{borderTopWidth:i}),U("state-border",{top:k})])])])])}const fe=$("button-group",`
 flex-wrap: nowrap;
 display: inline-flex;
 position: relative;
`,[B("vertical",{flexDirection:"row"},[B("rtl",[$("button",[L("&:first-child:not(:last-child)",`
 margin-right: ${i};
 border-top-right-radius: ${i};
 border-bottom-right-radius: ${i};
 `),L("&:last-child:not(:first-child)",`
 margin-left: ${i};
 border-top-left-radius: ${i};
 border-bottom-left-radius: ${i};
 `),L("&:not(:first-child):not(:last-child)",`
 margin-left: ${i};
 margin-right: ${i};
 border-radius: ${i};
 `),S("default"),c("ghost",[S("primary"),S("info"),S("success"),S("warning"),S("error")])])])]),c("vertical",{flexDirection:"column"},[$("button",[L("&:first-child:not(:last-child)",`
 margin-bottom: ${i};
 margin-left: ${i};
 margin-right: ${i};
 border-bottom-left-radius: ${i};
 border-bottom-right-radius: ${i};
 `),L("&:last-child:not(:first-child)",`
 margin-top: ${i};
 margin-left: ${i};
 margin-right: ${i};
 border-top-left-radius: ${i};
 border-top-right-radius: ${i};
 `),L("&:not(:first-child):not(:last-child)",`
 margin: ${i};
 border-radius: ${i};
 `),P("default"),c("ghost",[P("primary"),P("info"),P("success"),P("warning"),P("error")])])])]),ve={size:{type:String,default:void 0},vertical:Boolean},me=Y({name:"ButtonGroup",props:ve,setup(f){const{mergedClsPrefixRef:E,mergedRtlRef:y}=ee(f);return le("-button-group",fe,E),ae(oe,f),{rtlEnabled:te("ButtonGroup",y,E),mergedClsPrefix:E}},render(){const{mergedClsPrefix:f}=this;return Z("div",{class:[`${f}-button-group`,this.rtlEnabled&&`${f}-button-group--rtl`,this.vertical&&`${f}-button-group--vertical`],role:"group"},this.$slots)}}),ge={class:"admin-config-view"},Ee={class:"card-header"},Ie={class:"actions"},Me={class:"config-section"},be={class:"config-section"},Le={class:"form-grid"},Re={class:"config-section"},ce={class:"section-header"},Se={key:1,class:"mapper-visual"},Pe={class:"mapper-list"},Ae={class:"mapper-list"},Ce={class:"mapper-list"},we={class:"config-section"},$e={class:"section-header"},xe={class:"form-actions"},Oe={__name:"SystemConfigView",setup(f){const E=pe(),y=I(null),x=I(!1),N=I(!1),z=I(!1),R=I("text"),H=[{label:"不修改",value:""},{label:"启用",value:"true"},{label:"禁用",value:"false"}],s=I({XAI_MAIL:"",RESOURCES:"",MODEL_LIMITS:"",MODEL_PRICING:"",EMAIL_SMTP:"",EMAIL_PORT:"",EMAIL_AUTH:"",EMAIL_PASS:"",EMAIL_TLS:"",MODEL_MAPPER:"",LEVEL_MAPPER:"",SWITCH_OVER:"",PRICING:""}),A=I([]),C=I([]),w=I([]);re(()=>{O()}),ne(R,t=>{t==="visual"?W():j()});function W(){A.value=_(s.value.MODEL_MAPPER),C.value=_(s.value.LEVEL_MAPPER,!0),w.value=_(s.value.SWITCH_OVER,!0)}function j(){s.value.MODEL_MAPPER=A.value.filter(t=>t.from&&t.to).map(t=>`${t.from}=${t.to}`).join(","),s.value.LEVEL_MAPPER=C.value.filter(t=>t.from&&t.to!==void 0&&t.to!==null).map(t=>`${t.from}=${t.to}`).join(","),s.value.SWITCH_OVER=w.value.filter(t=>t.from!==void 0&&t.from!==null&&t.to!==void 0&&t.to!==null).map(t=>`${t.from}=${t.to}`).join(",")}function _(t,e=!1){return!t||!t.trim()?[]:t.split(",").map(l=>l.trim()).filter(l=>l.includes("=")).map(l=>{const[p,u]=l.split("=").map(X=>X.trim());return{from:e?p?Number(p):1:p,to:e?u?Number(u):1:u}})}function h(t){const e={from:"",to:""};t==="model"?A.value.push(e):t==="level"?C.value.push({from:"",to:1}):t==="switch"&&w.value.push({from:1,to:1})}function D(t,e){t==="model"?A.value.splice(e,1):t==="level"?C.value.splice(e,1):t==="switch"&&w.value.splice(e,1)}async function O(){x.value=!0;try{let e=(await F()).data;e?.success&&e?.configs&&(e=e.configs),Object.keys(s.value).forEach(l=>{e[l]!==void 0&&e[l]!==null&&(l==="MODEL_LIMITS"&&typeof e[l]=="object"||l==="PRICING"&&typeof e[l]=="object"?s.value[l]=JSON.stringify(e[l],null,2):l==="EMAIL_TLS"?s.value[l]=e[l]===!0?"true":e[l]===!1?"false":"":typeof e[l]=="object"?s.value[l]=Object.entries(e[l]).map(([p,u])=>`${p}=${u}`).join(","):Array.isArray(e[l])?s.value[l]=e[l].join(","):s.value[l]=String(e[l]))}),E.success("配置加载成功")}catch(t){const e=t?.response?.data?.message||t?.message||"加载配置失败";E.error(e)}finally{x.value=!1}}async function J(){R.value==="visual"&&j(),N.value=!0;try{const t={};Object.entries(s.value).forEach(([e,l])=>{if(l&&l.trim())if((e==="MODEL_LIMITS"||e==="PRICING")&&l.trim().startsWith("{"))try{t[e]=JSON.parse(l)}catch{t[e]=l}else t[e]=l}),await Q(t),E.success("配置保存成功"),await O()}catch(t){const e=t?.response?.data?.message||t?.message||"保存配置失败";E.error(e)}finally{N.value=!1}}async function K(){z.value=!0;try{await q(["PRICING"]),E.success("已恢复默认定价"),await O()}catch(t){const e=t?.response?.data?.message||t?.message||"恢复默认定价失败";E.error(e)}finally{z.value=!1}}return(t,e)=>(b(),M("section",ge,[a(o(ie),{class:"config-card",bordered:!1},{default:r(()=>[n("header",Ee,[e[19]||(e[19]=n("div",null,[n("h2",null,"系统配置管理"),n("p",null,"配置系统基础参数、邮件服务和模型映射规则")],-1)),n("div",Ie,[a(o(m),{secondary:"",size:"small",loading:x.value,onClick:O},{default:r(()=>[...e[18]||(e[18]=[g("刷新",-1)])]),_:1},8,["loading"])])]),a(o(ue),{ref_key:"formRef",ref:y,model:s.value,"label-placement":"top"},{default:r(()=>[n("div",Me,[e[24]||(e[24]=n("h3",{class:"section-title"},"基础配置",-1)),a(o(v),{label:"系统通知邮箱",path:"XAI_MAIL"},{feedback:r(()=>[...e[20]||(e[20]=[n("span",{class:"form-hint"},"系统通知邮箱",-1)])]),default:r(()=>[a(o(d),{value:s.value.XAI_MAIL,"onUpdate:value":e[0]||(e[0]=l=>s.value.XAI_MAIL=l),placeholder:"info@example.com"},null,8,["value"])]),_:1}),a(o(v),{label:"允许的资源路径",path:"RESOURCES"},{feedback:r(()=>[...e[21]||(e[21]=[n("span",{class:"form-hint"},"逗号分隔的API路径列表",-1)])]),default:r(()=>[a(o(d),{value:s.value.RESOURCES,"onUpdate:value":e[1]||(e[1]=l=>s.value.RESOURCES=l),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"/v1/chat/completions,/v1/messages,/v1/embeddings"},null,8,["value"])]),_:1}),a(o(v),{label:"模型限制",path:"MODEL_LIMITS"},{feedback:r(()=>[...e[22]||(e[22]=[n("span",{class:"form-hint"},'JSON格式：{"模型名":限制数}',-1)])]),default:r(()=>[a(o(d),{value:s.value.MODEL_LIMITS,"onUpdate:value":e[2]||(e[2]=l=>s.value.MODEL_LIMITS=l),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:'{"gpt-4o":100,"gpt-4o-mini":500}'},null,8,["value"])]),_:1}),a(o(v),{label:"模型定价 (Owner 覆盖)",path:"MODEL_PRICING"},{feedback:r(()=>[...e[23]||(e[23]=[n("span",{class:"form-hint"},"JSON格式：自定义模型价格（USD/1K tokens），覆盖系统默认定价。支持 prompt 和 completion 分别定价",-1)])]),default:r(()=>[a(o(d),{value:s.value.MODEL_PRICING,"onUpdate:value":e[3]||(e[3]=l=>s.value.MODEL_PRICING=l),type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:'{"gpt-4o":{"prompt":0.0025,"completion":0.01},"gpt-4o-mini":{"prompt":0.00015,"completion":0.0006}}'},null,8,["value"])]),_:1})]),n("div",be,[e[25]||(e[25]=n("h3",{class:"section-title"},"邮件配置",-1)),n("div",Le,[a(o(v),{label:"SMTP 服务器",path:"EMAIL_SMTP"},{default:r(()=>[a(o(d),{value:s.value.EMAIL_SMTP,"onUpdate:value":e[4]||(e[4]=l=>s.value.EMAIL_SMTP=l),placeholder:"smtp.gmail.com"},null,8,["value"])]),_:1}),a(o(v),{label:"SMTP 端口",path:"EMAIL_PORT"},{default:r(()=>[a(o(d),{value:s.value.EMAIL_PORT,"onUpdate:value":e[5]||(e[5]=l=>s.value.EMAIL_PORT=l),placeholder:"465"},null,8,["value"])]),_:1}),a(o(v),{label:"认证邮箱",path:"EMAIL_AUTH"},{default:r(()=>[a(o(d),{value:s.value.EMAIL_AUTH,"onUpdate:value":e[6]||(e[6]=l=>s.value.EMAIL_AUTH=l),type:"email",placeholder:"xproxyai@gmail.com"},null,8,["value"])]),_:1}),a(o(v),{label:"邮箱密码",path:"EMAIL_PASS"},{default:r(()=>[a(o(d),{value:s.value.EMAIL_PASS,"onUpdate:value":e[7]||(e[7]=l=>s.value.EMAIL_PASS=l),type:"password",placeholder:"••••••••••••••••"},null,8,["value"])]),_:1}),a(o(v),{label:"启用 TLS",path:"EMAIL_TLS"},{default:r(()=>[a(o(de),{value:s.value.EMAIL_TLS,"onUpdate:value":e[8]||(e[8]=l=>s.value.EMAIL_TLS=l),options:H,placeholder:"选择 TLS 设置"},null,8,["value"])]),_:1})])]),n("div",Re,[n("div",ce,[e[28]||(e[28]=n("h3",{class:"section-title"},"映射配置",-1)),a(o(me),{size:"small"},{default:r(()=>[a(o(m),{type:R.value==="visual"?"primary":"default",onClick:e[9]||(e[9]=l=>R.value="visual")},{default:r(()=>[...e[26]||(e[26]=[g(" 可视化 ",-1)])]),_:1},8,["type"]),a(o(m),{type:R.value==="text"?"primary":"default",onClick:e[10]||(e[10]=l=>R.value="text")},{default:r(()=>[...e[27]||(e[27]=[g(" 文本 ",-1)])]),_:1},8,["type"])]),_:1})]),R.value==="text"?(b(),M(T,{key:0},[a(o(v),{label:"系统模型映射",path:"MODEL_MAPPER"},{feedback:r(()=>[...e[29]||(e[29]=[n("span",{class:"form-hint"},"格式：原模型=目标模型，逗号分隔多个映射 (例如 gpt-3.5*=gpt-4o-mini 代表将任何gpt-3.5模型请求转换为gpt-4o-mini)",-1)])]),default:r(()=>[a(o(d),{value:s.value.MODEL_MAPPER,"onUpdate:value":e[11]||(e[11]=l=>s.value.MODEL_MAPPER=l),type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"gpt-3.5*=gpt-4o-mini,gpt-4=gpt-4o"},null,8,["value"])]),_:1}),a(o(v),{label:"模型分组映射",path:"LEVEL_MAPPER"},{feedback:r(()=>[...e[30]||(e[30]=[n("span",{class:"form-hint"},"格式：模型=分组号，逗号分隔多个映射 (例如 gpt 系列模型由1号分组的 AI Provider 处理, claude 系列模型由2号分组的 AI Provider处理)",-1)])]),default:r(()=>[a(o(d),{value:s.value.LEVEL_MAPPER,"onUpdate:value":e[12]||(e[12]=l=>s.value.LEVEL_MAPPER=l),type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"gpt*=1,text*=1,claude*=2,doubao*=3,qwen*=4,deepseek*=5"},null,8,["value"])]),_:1}),a(o(v),{label:"模型分组主备切换",path:"SWITCH_OVER"},{feedback:r(()=>[...e[31]||(e[31]=[n("span",{class:"form-hint"},"格式：主分组=备分组，逗号分隔多个映射(当模型主分组一分钟内超过5次异常响应,则触发切换到模型备分组,1小时后自动切回)",-1)])]),default:r(()=>[a(o(d),{value:s.value.SWITCH_OVER,"onUpdate:value":e[13]||(e[13]=l=>s.value.SWITCH_OVER=l),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"1=10,2=20"},null,8,["value"])]),_:1})],64)):(b(),M("div",Se,[e[41]||(e[41]=n("h4",null,"系统模型映射",-1)),n("div",Pe,[(b(!0),M(T,null,V(A.value,(l,p)=>(b(),M("div",{key:p,class:"mapper-row"},[a(o(d),{value:l.from,"onUpdate:value":u=>l.from=u,placeholder:"原模型 (支持通配符*)",size:"small"},null,8,["value","onUpdate:value"]),e[33]||(e[33]=n("span",{class:"mapper-arrow"},"→",-1)),a(o(d),{value:l.to,"onUpdate:value":u=>l.to=u,placeholder:"目标模型",size:"small"},null,8,["value","onUpdate:value"]),a(o(m),{text:"",type:"error",size:"small",onClick:u=>D("model",p)},{default:r(()=>[...e[32]||(e[32]=[g("删除",-1)])]),_:1},8,["onClick"])]))),128)),a(o(m),{text:"",size:"small",onClick:e[14]||(e[14]=l=>h("model"))},{default:r(()=>[...e[34]||(e[34]=[g("+ 添加映射",-1)])]),_:1})]),e[42]||(e[42]=n("h4",null,"模型分组映射",-1)),n("div",Ae,[(b(!0),M(T,null,V(C.value,(l,p)=>(b(),M("div",{key:p,class:"mapper-row"},[a(o(d),{value:l.from,"onUpdate:value":u=>l.from=u,placeholder:"模型名 (支持通配符*)",size:"small"},null,8,["value","onUpdate:value"]),e[36]||(e[36]=n("span",{class:"mapper-arrow"},"→",-1)),a(o(G),{value:l.to,"onUpdate:value":u=>l.to=u,placeholder:"分组号",size:"small",min:1,max:99},null,8,["value","onUpdate:value"]),a(o(m),{text:"",type:"error",size:"small",onClick:u=>D("level",p)},{default:r(()=>[...e[35]||(e[35]=[g("删除",-1)])]),_:1},8,["onClick"])]))),128)),a(o(m),{text:"",size:"small",onClick:e[15]||(e[15]=l=>h("level"))},{default:r(()=>[...e[37]||(e[37]=[g("+ 添加分组",-1)])]),_:1})]),e[43]||(e[43]=n("h4",null,"模型分组主备切换",-1)),n("div",Ce,[(b(!0),M(T,null,V(w.value,(l,p)=>(b(),M("div",{key:p,class:"mapper-row"},[a(o(G),{value:l.from,"onUpdate:value":u=>l.from=u,placeholder:"主分组",size:"small",min:1,max:99},null,8,["value","onUpdate:value"]),e[39]||(e[39]=n("span",{class:"mapper-arrow"},"→",-1)),a(o(G),{value:l.to,"onUpdate:value":u=>l.to=u,placeholder:"备分组",size:"small",min:1,max:99},null,8,["value","onUpdate:value"]),a(o(m),{text:"",type:"error",size:"small",onClick:u=>D("switch",p)},{default:r(()=>[...e[38]||(e[38]=[g("删除",-1)])]),_:1},8,["onClick"])]))),128)),a(o(m),{text:"",size:"small",onClick:e[16]||(e[16]=l=>h("switch"))},{default:r(()=>[...e[40]||(e[40]=[g("+ 添加切换规则",-1)])]),_:1})])]))]),n("div",we,[n("div",$e,[e[45]||(e[45]=n("h3",{class:"section-title"},"模型定价（Owner 覆盖）",-1)),a(o(m),{secondary:"",size:"small",onClick:K,loading:z.value},{default:r(()=>[...e[44]||(e[44]=[g(" 恢复默认定价 ",-1)])]),_:1},8,["loading"])]),a(o(v),{label:"定价配置 (JSON)",path:"PRICING"},{feedback:r(()=>[...e[46]||(e[46]=[n("span",{class:"form-hint"},'JSON 格式：模型名 → {"prompt": 价格, "completion": 价格}，单位为 USD per 1K tokens',-1)])]),default:r(()=>[a(o(d),{value:s.value.PRICING,"onUpdate:value":e[17]||(e[17]=l=>s.value.PRICING=l),type:"textarea",autosize:{minRows:8,maxRows:15},placeholder:'{"gpt-4o": {"prompt": 0.005, "completion": 0.015}, "gpt-4o-mini": {"prompt": 0.00015, "completion": 0.0006}}'},null,8,["value"])]),_:1})]),n("div",xe,[a(o(m),{type:"primary",size:"large",loading:N.value,onClick:J},{icon:r(()=>[...e[47]||(e[47]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])]),default:r(()=>[e[48]||(e[48]=g(" 保存配置 ",-1))]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})]))}},Ne=se(Oe,[["__scopeId","data-v-7be9d57b"]]);export{Ne as default};
